@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutDMST.cshtml";
}

@model E_Learning.ModelsDMST.PhieuDangKyView

<link href="~/Content/assets/css/PagedList.css" rel="stylesheet" />
<script src="~/Content/assets/Chonse/chosen.jquery.js"></script>
<link href="~/Content/assets/Chonse/chosen.css" rel="stylesheet" />
<link href="~/Content/PagedList.css" rel="stylesheet" />
<script src="~/Content/bootstrap.bundle.min.js"></script>

<script src="~/Content/assets/TinyMCE/tinimceConfig.js"></script>
<style>
    .noti,
    .btnnoti {
        display: none;
    }

    a {
        text-decoration: none;
    }
</style>
@if (TempData["msgSuccess"] != null)
{
    @Html.Raw(TempData["msgSuccess"])
}
@if (TempData["msgError"] != null)
{
    @Html.Raw(TempData["msgError"])
}

<div class="app-main__outer">
    <div class="app-main__inner">
        <div class="tab-content pt-3">
            @*<div class="app-page-title">
                </div>*@
            <div class="row">
                <div class="card w-100">
                    <div class="d-flex justify-content-between align-items-center mt-3 px-3">
                        <h3 class="text-center flex-grow-1">
                            <b>ĐỀ XUẤT ĐỔI MỚI SÁNG TẠO</b>
                        </h3>
                        <button class="btn btn-primary ms-3">Lưu</button>
                    </div>
                    <div class="alert alert-success fade show text-center" role="alert">Vui mừng chào đón bạn trở lại. Chúng ta cùng nhau tạo nên những ý tưởng mới mẻ và khám phá vô vàn cơ hội sáng tạo nhé!</div>

                    <div class="card-body" style="padding-top:8px">

                        <ul class="nav nav-tabs mb-1 nav-justified" id="innovationTab" role="tablist">
                            <li class="nav-item"><a class="nav-link active font-weight-bold" data-bs-toggle="tab" href="#tab1">Đăng ký ý tưởng</a></li>
                            @*<li class="nav-item"><a class="nav-link font-weight-bold" data-bs-toggle="tab" href="#tab2">Trình ký</a></li>*@
                            <li class="nav-item"><a class="nav-link font-weight-bold" data-bs-toggle="tab" href="#tab3">Chuẩn bị thực hiện</a></li>
                            <li class="nav-item"><a class="nav-link font-weight-bold" data-bs-toggle="tab" href="#tab4">Triển khai thực hiện</a></li>
                            <li class="nav-item"><a class="nav-link font-weight-bold" data-bs-toggle="tab" href="#tab5">Bàn giao đưa vào sử dụng</a></li>
                            <li class="nav-item"><a class="nav-link font-weight-bold" data-bs-toggle="tab" href="#tab6">Đề nghị công nhận</a></li>
                        </ul>


                        <div class="tab-content">

                            <div class="tab-pane fade show active " id="tab1" style="overflow-y: auto; overflow-x: hidden;max-height:700px">
                                @using (Html.BeginForm("SubmitYTuong", "RenewCreative", FormMethod.Post, new { enctype = "multipart/form-data", id = "formDangKyYTuong" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <small class="text-muted">
                                        Người đề xuất lựa chọn một trong hai nội dung chính của mỗi hoạt động là: Quy trình/Thủ tục và Phương pháp thực hiện công việc.<br />
                                        a) Quy trình/Thủ tục: "Bạn chọn mục này nếu đề xuất của bạn liên quan tới các quy trình, thủ tục đã được nêu trong các văn bản quy phạm nội bộ của Công ty hoặc chưa được nêu mà bạn đề xuất bổ sung".<br />
                                        b) Phương pháp thực hiện công việc: "Bạn chọn mục này nếu đề xuất của bạn liên quan tới các cách thức, giải pháp kỹ thuật hoặc các phương pháp cụ thể để thực hiện công việc một cách hiệu quả".
                                    </small>

                                    <div class="divider mb-1"></div>
                                    <h5 class="mt-3">1. Thông tin cá nhân đại diện</h5>
                                    <div class="row">
                                        <div class="mb-1 col">
                                            <div class="row align-items-end mb-2">
                                                <div class="col-md-8">
                                                    <label class="form-label">Cá nhân đại diện (Mã nhân viên)</label>
                                                    @Html.TextBox("MaNhanVien", null, new { @class = "form-control form-control-sm", placeholder = "Nhập mã nhân viên", @id = "MaNhanVien" })
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="button" class="btn btn-sm btn-primary mt-2" id="btnTaiNhanVien">
                                                        Tải dữ liệu
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="mb-2">
                                                <label class="form-label">Thông tin nhân viên</label>
                                                <input type="text" class="form-control form-control-sm" id="ThongTinNhanVien" readonly />
                                                @Html.HiddenFor(m => m.ID_NhanVienDaiDien)
                                            </div>


                                        </div>
                                        <div class="mb-1 col">
                                            <label class="form-label">Ngày đề xuất </label>
                                            @Html.TextBoxFor(m => m.NgayDeXuat, "{0:yyyy-MM-dd}", new { @type = "date", @class = "form-control form-control-sm" })
                                        </div>
                                    </div>

                                    <h5 class="mt-3">2. Thông tin ý tưởng</h5>

                                    <div class="mb-1">
                                        <label class="form-label">Tên ý tưởng</label>
                                        @Html.TextBoxFor(m => m.TenYTuong, new { @class = "form-control form-control-sm" })
                                    </div>

                                    <div class="row">
                                        <div class="mb-1 col-6">
                                            <label class="form-label">Hoạt động</label>
                                            @Html.DropDownList("HoatDong", new SelectList(new[] { "Quy trình/Thủ tục", "Phương pháp thực hiện công việc" }), new { @class = "form-control form-control-sm" })
                                        </div>
                                        <div class="mb-1 col-6">
                                            <label class="form-label">Lĩnh vực</label>
                                            @Html.DropDownListFor(m => m.ID_LinhVuc, new SelectList(ViewBag.DSLinhVuc, "Value", "Text"), "-- Chọn lĩnh vực --", new { @class = "form-control form-control-sm" })
                                        </div>
                                    </div>

                                    <p class="text-uppercase text-dark fw-bold">Mô tả ý tưởng</p>

                                    <div class="mb-1 row">
                                        <label class="col-sm-2 col-form-label">Nội dung ý tưởng</label>
                                        <div class="col-sm-10">
                                            @Html.TextAreaFor(m => m.NoiDungYTuong, new { @class = "form-control form-control-sm", rows = 3 })
                                        </div>
                                    </div>

                                    <div class="mb-1 row">
                                        <label class="col-sm-2 col-form-label">Lý do thực hiện</label>
                                        <div class="col-sm-10">
                                            @Html.TextAreaFor(m => m.LyDoThucHien, new { @class = "form-control form-control-sm", rows = 3 })
                                        </div>
                                    </div>

                                    <div class="mb-1 row">
                                        <label class="col-sm-2 col-form-label">Vị trí triển khai</label>
                                        <div class="col-sm-10">
                                            @Html.TextBoxFor(m => m.ViTriTrienKhai, new { @class = "form-control form-control-sm" })
                                        </div>
                                    </div>

                                    <div class="mb-1 row">
                                        <label for="exampleSelectMulti" class="col-sm-2 col-form-label">Thời gian dự kiến triển khai</label>
                                        <div class="col-sm-6 d-flex">
                                            @Html.DropDownListFor(m => m.TinhTrang, new List<SelectListItem> {
                                                new SelectListItem { Text = "Chưa áp dụng", Value = "1" },
                                                new SelectListItem { Text = "Đã áp dụng", Value = "2" }
                                            }, new { @class = "form-control form-control-sm", id = "yTuongType" })
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="row mb-1 row align-items-center" id="timeInputWrapper" style="display: none;">
                                                <label class="col-form-label">Từ ngày</label>
                                                <div class="col-sm-6">
                                                    @Html.TextBoxFor(m => m.TuNgay, "{0:yyyy-MM-dd}", new { @type = "date", @class = "form-control form-control-sm" })
                                                </div>
                                                <label class="col-form-label">Đến ngày</label>
                                                <div class="col-sm-6">
                                                    @Html.TextBoxFor(m => m.DenNgay, "{0:yyyy-MM-dd}", new { @type = "date", @class = "form-control form-control-sm" })
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <script>
                                        document.getElementById('yTuongType').addEventListener('change', function () {
                                            const selectedValue = this.value;
                                            const timeInputWrapper = document.getElementById('timeInputWrapper');

                                            if (selectedValue === '2') {
                                                timeInputWrapper.style.display = 'block';
                                            } else {
                                                timeInputWrapper.style.display = 'none';
                                            }
                                        });
                                    </script>
                                    <div class="mb-1 row">
                                        <label class="col-sm-2 col-form-label">Người tham gia / Vai trò</label>
                                        <div class="col-sm-10">
                                            <table class="table table-bordered align-middle" id="TableNguoiThamGia">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 35%">Mã nhân viên</th>
                                                        <th style="width: 5%"></th>
                                                        <th style="width: 25%">Vai trò</th>
                                                        <th style="width: 5%">Xóa</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                            <button class="btn btn-sm btn-outline-primary" type="button" id="btnAddNguoiThamGia"><i class="fa fa-plus"></i> Thêm</button>
                                        </div>
                                    </div>

                                    @Html.HiddenFor(m => m.NguoiThamGiaJson, new { id = "NguoiThamGiaJson" })

                                    <script>
                                        let indexNguoi = 0;

                                        $('#btnAddNguoiThamGia').on('click', function () {
                                            const row = `
                                                <tr>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm ma-nv" placeholder="Nhập mã nhân viên" />
                                                        <input type="hidden" class="id-nv-hidden" />
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-sm btn-secondary btn-tai">Tải</button>
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm vai-tro" placeholder="Vai trò" />
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-sm btn-danger btn-xoa">X</button>
                                                    </td>
                                                </tr>`;
                                            $('#TableNguoiThamGia tbody').append(row);
                                        });

                                        $(document).on('click', '.btn-xoa', function () {
                                            $(this).closest('tr').remove();
                                        });

                                        $(document).on('click', '.btn-tai', function () {
                                            const row = $(this).closest('tr');
                                            const ma = row.find('.ma-nv').val().trim();
                                            const input = row.find('.ma-nv');

                                            if (!ma) {
                                                return alert("Nhập mã nhân viên!");
                                            }

                                            $.get('@Url.Action("LayNhanVienTheoMa", "RenewCreative")', { maNhanVien: ma }, function (res) {
                                                if (res && res.id > 0) {
                                                    row.find('.ma-nv').val(`${res.ma} - ${res.ten}`).removeClass('is-invalid');
                                                    row.find('.id-nv-hidden').val(res.id);
                                                } else {
                                                    input.addClass('is-invalid');
                                                }
                                            });
                                        });

                                        // truoc khi submit form
                                        $('#formDangKyYTuong').on('submit', function (e) {
                                            let ds = [];
                                            let isValid = true;

                                            $('#TableNguoiThamGia tbody tr').each(function () {
                                                const id = $(this).find('.id-nv-hidden').val();
                                                const vaiTro = $(this).find('.vai-tro').val();
                                                const maInput = $(this).find('.ma-nv');

                                                if (!id) {
                                                    isValid = false;
                                                    maInput.addClass('is-invalid');
                                                } else {
                                                    ds.push({ ID_NhanVien: id, VaiTro: vaiTro });
                                                }
                                            });

                                            if (!isValid) {
                                                alert('Vui lòng kiểm tra lại thông tin mã nhân viên!');
                                                e.preventDefault();
                                                return false;
                                            }

                                            $('#NguoiThamGiaJson').val(JSON.stringify(ds));
                                            return true;
                                        });
                                    </script>
                                    <div class="mb-1 row">
                                        <label for="exampleEmail" class="col-sm-2 col-form-label">Cách thức thực hiện</label>
                                        <div class="col-sm-10">
                                            @Html.TextBoxFor(m => m.CachThucThucHien, new { @class = "form-control form-control-sm myTextarea" })
                                        </div>

                                    </div>
                                    <div class="mb-1 row">
                                        <label for="exampleText" class="col-sm-2 col-form-label">Dự kiến chi phí triển khai</label>
                                        <div class="col-sm-10">
                                            <table class="table table-bordered align-middle" id="TableChiPhi">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 20%">Tên nguồn lực</th>
                                                        <th style="width: 25%">Chi phí (đồng)</th>
                                                        <th style="width: 25%">Nguồn thông tin</th>
                                                        <th style="width: 25%">Ghi chú</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (Model != null && Model.KinhPhiDuKien != null && Model.KinhPhiDuKien.Count > 0)
                                                    {
                                                        for (int i = 0; i < Model.KinhPhiDuKien.Count; i++)
                                                        {
                                                            <tr>
                                                                <td>@Html.TextBoxFor(m => m.KinhPhiDuKien[i].TenNguonLuc, new { @class = "form-control form-control-sm" })
                                                                <td>
                                                                <td>@Html.TextBoxFor(m => m.KinhPhiDuKien[i].ChiPhi, new { @class = "form-control form-control-sm" })</td>
                                                                <td>@Html.TextBoxFor(m => m.KinhPhiDuKien[i].NguonThongTin, new { @class = "form-control form-control-sm" })</td>
                                                                <td>@Html.TextBoxFor(m => m.KinhPhiDuKien[i].GhiChu, new { @class = "form-control form-control-sm" })</td>
                                                            </tr>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <tr>
                                                            <td><input type="text" name="KinhPhiDuKien[0].TenNguonLuc" class="form-control form-control-sm" /></td>
                                                            <td><input type="text" name="KinhPhiDuKien[0].ChiPhi" class="form-control form-control-sm" /></td>
                                                            <td><input type="text" name="KinhPhiDuKien[0].NguonThongTin" class="form-control form-control-sm" /></td>
                                                            <td><input type="text" name="KinhPhiDuKien[0].GhiChu" class="form-control form-control-sm" /></td>
                                                        </tr>
                                                    }

                                                </tbody>
                                            </table>

                                            <button type="button" class="btn btn-sm btn-outline-primary" id="btnAddChiPhi">
                                                <i class="fa fa-plus"></i> Thêm
                                            </button>
                                        </div>
                                        @{
                                            var chiPhiIndex = (Model?.KinhPhiDuKien != null) ? Model.KinhPhiDuKien.Count : 1;
                                        }
                                        <script>
                                            let chiPhiIndex = @chiPhiIndex;

                                            document.getElementById("btnAddChiPhi").addEventListener("click", function () {
                                                const tbody = document.querySelector("#TableChiPhi tbody");
                                                const row = document.createElement("tr");

                                                row.innerHTML = `
                                                    <td><input type="text" name="KinhPhiDuKien[${chiPhiIndex}].TenNguonLuc" class="form-control form-control-sm" /></td>
                                                    <td><input type="text" name="KinhPhiDuKien[${chiPhiIndex}].ChiPhi" class="form-control form-control-sm" /></td>
                                                    <td><input type="text" name="KinhPhiDuKien[${chiPhiIndex}].NguonThongTin" class="form-control form-control-sm" /></td>
                                                    <td><input type="text" name="KinhPhiDuKien[${chiPhiIndex}].GhiChu" class="form-control form-control-sm" /></td>
                                                `;
                                                tbody.appendChild(row);
                                                chiPhiIndex++;
                                            });
                                        </script>

                                    </div>
                                    <div class="text-uppercase text-dark fw-bold">Khả năng triển khai</div>
                                    <div class="row">
                                        <label class="col-sm-2 col-form-label">Công việc được thực hiện khi:</label>
                                        <div class="col-sm-10">
                                            <div class="d-flex flex-wrap gap-4 mt-2">
                                                <div class="form-check">
                                                    @Html.RadioButtonFor(m => m.ThucHienKhi, 0, new { @class = "form-check-input", id = "sx1" })
                                                    <label class="form-check-label" for="sx1">Đang sản xuất</label>
                                                </div>
                                                <div class="form-check">
                                                    @Html.RadioButtonFor(m => m.ThucHienKhi, 1, new { @class = "form-check-input", id = "sx2" })
                                                    <label class="form-check-label" for="sx2">Dừng sản xuất</label>
                                                </div>
                                                <div class="form-check">
                                                    @Html.RadioButtonFor(m => m.ThucHienKhi, 2, new { @class = "form-check-input", id = "sx3" })
                                                    <label class="form-check-label" for="sx3">Thời gian bất kỳ</label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-sm-2 col-form-label">Cần thử nghiệm/nghiên cứu thêm:</label>
                                        <div class="col-sm-10">
                                            <div class="d-flex flex-wrap gap-4 mt-2">
                                                <div class="form-check">
                                                    @Html.RadioButtonFor(m => m.CanThuNghiemThem, 1, new { @class = "form-check-input", id = "thu1" })
                                                    <label class="form-check-label" for="thu1">Có</label>
                                                </div>
                                                <div class="form-check">
                                                    @Html.RadioButtonFor(m => m.CanThuNghiemThem, 0, new { @class = "form-check-input", id = "thu2" })
                                                    <label class="form-check-label" for="thu2">Không</label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-sm-2 col-form-label">Cần hỗ trợ gì khi triển khai?</label>
                                        <div class="col-sm-10">
                                            @Html.TextBoxFor(m => m.CanHoTro, new { @class = "form-control form-control-sm" })
                                        </div>
                                    </div>
                                    <div class="mb-1 row">
                                        <label for="exampleEmail" class="col-sm-2 col-form-label">Lợi ích/hiệu quả kỳ vọng</label>
                                        <div class="col-sm-10">
                                            @Html.TextAreaFor(m => m.HieuQuaKyVong, new { @class = "form-control form-control-sm myTextarea", rows = 3 })
                                        </div>
                                    </div>
                                    <div class="mb-1 row">
                                        <label for="exampleEmail" class="col-sm-2 col-form-label">Đề xuất người/BP triển khai (nếu có)</label>
                                        <div class="col-sm-10">
                                            @Html.TextAreaFor(m => m.DeXuatNguoiBoPhan, new { @class = "form-control form-control-sm", rows = 3 })
                                        </div>
                                    </div>

                                    <div class="mb-1 row">
                                        <label for="exampleFile" class="col-sm-2 col-form-label">File đính kèm</label>
                                        <div class="col-sm-10">
                                            <input type="file" class="form-control form-control-sm" id="exampleFile">
                                            <small class="text-muted">Chấp nhận định dạng .pdf, .docx, .xlsx</small>
                                        </div>
                                    </div>

                                    <button class="btn btn-sm btn-primary mt-2" type="submit">
                                        Lưu ý tưởng
                                    </button>
                                    @*<button class="btn btn-sm btn-primary mt-2" type="submit">Lưu ý tưởng</button>*@
                                }

                            </div>


                            <div class="tab-pane fade show active " id="tab2" style="overflow-y: auto; overflow-x: hidden;max-height:700px">
                                @*<div class="mb-1">
                                        <label class="form-label">Người ký duyệt</label>
                                        <input type="text" class="form-control" placeholder="Nhập tên người ký">
                                    </div>
                                    <div class="mb-1">
                                        <label class="form-label">Ngày ký</label>
                                        <input type="date" class="form-control">
                                    </div>
                                    <button class="btn btn-success">Trình ký</button>*@
                            </div>

                            <div class="tab-pane fade show" id="tab3">
                                <form>
                                    <h5 class="mt-3">1. Thông tin chung</h5>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="tenYTuong" class="form-label">Tên ý tưởng</label>
                                            <select class="form-control" id="tenYTuong">
                                                <option selected disabled>-- Chọn ý tưởng --</option>
                                                <option>Ý tưởng 1</option>
                                                <option>Ý tưởng 2</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="boPhan" class="form-label">Bộ phận</label>
                                            <select class="form-control" id="boPhan">
                                                <option selected disabled>-- Chọn bộ phận --</option>
                                                <option>Bộ phận A</option>
                                                <option>Bộ phận B</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Người triển khai -->
                                    <div class="row mb-4 align-items-end">
                                        <div class="col-md-9">
                                            <label for="nguoiTrienKhai" class="form-label">Người triển khai (nhập mã nhân viên cách nhau bởi dấu phẩy hoặc xuống dòng)</label>
                                            <textarea id="nguoiTrienKhai" class="form-control" rows="3" placeholder="VD: NV001, NV002 hoặc mỗi mã 1 dòng"></textarea>
                                        </div>
                                        <div class="col-md-3 text-end">
                                            <button type="button" class="btn btn-primary mt-3" id="taiNhanVien">Tải dữ liệu</button>
                                        </div>
                                    </div>

                                    <!-- Kết quả danh sách nhân viên -->
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label class="form-label">Danh sách nhân viên</label>
                                            <ul class="list-group" id="danhSachNhanVien"></ul>
                                        </div>
                                    </div>


                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label for="ngayBatDau" class="form-label">Ngày bắt đầu triển khai</label>
                                            <input type="date" class="form-control" id="ngayBatDau">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="ngayKetThuc" class="form-label">Dự kiến hoàn thành</label>
                                            <input type="date" class="form-control" id="ngayKetThuc">
                                        </div>
                                    </div>

                                    <h5>2. Mục tiêu thực hiện</h5>
                                    <div class="mb-4">
                                        <textarea class="form-control" rows="4" placeholder="Nhập mục tiêu thực hiện..."></textarea>
                                    </div>

                                    <h5>3. Kế hoạch triển khai chi tiết</h5>

                                    <h6 class="mt-3">3.1 Nguồn lực</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="nguonLucTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th style="width: 40px;">STT</th>
                                                    <th>Nội dung công việc chuẩn bị</th>
                                                    <th>Số lượng</th>
                                                    <th>Người thực hiện</th>
                                                    <th>Thời gian</th>
                                                    <th>Ghi chú</th>
                                                    <th style="width: 60px;"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="stt">1</td>
                                                    <td><input type="text" class="form-control"></td>
                                                    <td><input type="number" class="form-control"></td>
                                                    <td><input type="text" class="form-control"></td>
                                                    <td><input type="text" class="form-control"></td>
                                                    <td><input type="text" class="form-control"></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="addRow"><i class="fa fa-plus"></i>Thêm </button>

                                    <h6>3.2 Chi phí dự kiến</h6>
                                    <div class="mb-3">
                                        <input type="text" class="form-control" placeholder="Nhập chi phí dự kiến">
                                    </div>

                                    <h6>3.3 Thuận lợi - khó khăn</h6>
                                    <div class="mb-3">
                                        <textarea class="form-control" rows="3" placeholder="Nhập thuận lợi và khó khăn..."></textarea>
                                    </div>

                                    <h6>3.4 Đề nghị hỗ trợ</h6>
                                    <div class="mb-3">
                                        <textarea class="form-control" rows="3" placeholder="Nhập đề nghị hỗ trợ..."></textarea>
                                    </div>
                                </form>
                            </div>

                            <div class="tab-pane fade" id="tab4">
                                <div class="mb-1">
                                    <label class="form-label">Tiến độ thực hiện</label>
                                    <input type="text" class="form-control" placeholder="Ví dụ: Đang thực hiện 50%">
                                </div>
                                <div class="mb-1">
                                    <label class="form-label">Người phụ trách</label>
                                    <input type="text" class="form-control" placeholder="Tên người phụ trách">
                                </div>
                                <button class="btn btn-warning">Cập nhật tiến độ</button>
                            </div>

                            <div class="tab-pane fade" id="tab5">
                                <div class="mb-1">
                                    <label class="form-label">Ngày bàn giao</label>
                                    <input type="date" class="form-control">
                                </div>
                                <div class="mb-1">
                                    <label class="form-label">Trạng thái sử dụng</label>
                                    <select class="form-control">
                                        <option>Đang sử dụng</option>
                                        <option>Đang thử nghiệm</option>
                                        <option>Tạm dừng</option>
                                    </select>
                                </div>
                                <button class="btn btn-info">Xác nhận bàn giao</button>
                            </div>

                            <div class="tab-pane fade" id="tab6">
                                <div class="mb-1">
                                    <label class="form-label">Đề xuất công nhận</label>
                                    <textarea class="form-control" rows="3" placeholder="Mô tả thành quả"></textarea>
                                </div>
                                <div class="mb-1">
                                    <label class="form-label">Mức độ hoàn thành</label>
                                    <select class="form-control">
                                        <option>Xuất sắc</option>
                                        <option>Đạt yêu cầu</option>
                                        <option>Không đạt</option>
                                    </select>
                                </div>
                                <button class="btn btn-dark">Gửi đề nghị</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#addRow').click(function () {
            const table = $('#nguonLucTable tbody');
            const stt = table.find('tr').length + 1;
            const row = `
        <tr>
          <td class="stt">${stt}</td>
          <td><input type="text" class="form-control"></td>
          <td><input type="number" class="form-control"></td>
          <td><input type="text" class="form-control"></td>
          <td><input type="text" class="form-control"></td>
          <td><input type="text" class="form-control"></td>
          <td><button type="button" class="btn btn-sm btn-danger remove-row">X</button></td>
        </tr>`;
            table.append(row);
        });

        $('#nguonLucTable').on('click', '.remove-row', function () {
            $(this).closest('tr').remove();
            $('#nguonLucTable .stt').each(function (index) {
                $(this).text(index + 1);
            });
        });

        $('#taiNhanVien').click(function () {
            const rawInput = $('#nguoiTrienKhai').val();
            const maNhanViens = rawInput.split(/[\n,]+/).map(m => m.trim()).filter(Boolean);

            const danhSachNhanVien = [];

            const allNhanVien = {
                'NV001': 'Nguyễn Văn A',
                'NV002': 'Trần Thị B',
                'NV003': 'Lê Văn C',
                'NV004': 'Phạm Thị D'
            };

            $('#danhSachNhanVien').empty();

            const uniqueMaNhanViens = Array.from(new Set(
                maNhanViens.filter(Boolean)
            ));

            uniqueMaNhanViens.forEach((ma) => {
                const ten = allNhanVien[ma] || '(Không tìm thấy)';
                $('#danhSachNhanVien').append(`<li class="list-group-item">${ma} - ${ten}</li>`);
            });

            if (uniqueMaNhanViens.length === 0) {
                $('#danhSachNhanVien').append(`<li class="list-group-item text-muted">Chưa có mã nhân viên hợp lệ.</li>`);
            }

            if (maNhanViens.length === 0) {
                $('#danhSachNhanVien').append(`<li class="list-group-item text-muted">Chưa có mã nhân viên hợp lệ.</li>`);
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('#btnTaiNhanVien').click(function () {
            const maNV = $('#MaNhanVien').val();
            if (!maNV) {
                alert('Vui lòng nhập mã nhân viên.');
                return;
            }

            $.ajax({
                url: '@Url.Action("LayNhanVienTheoMa", "RenewCreative")',
                type: 'GET',
                data: { maNhanVien: maNV },
                success: function (res) {
                    if (res && res.id > 0) {
                        $('#ThongTinNhanVien').val(res.ma + " - " + res.ten);
                        $('#ID_NhanVienDaiDien').val(res.id);
                    } else {
                        $('#ThongTinNhanVien').val('Không tìm thấy nhân viên');
                        $('#ID_NhanVienDaiDien').val('');
                    }
                },
                error: function () {
                    alert('Có lỗi xảy ra!');
                }
            });
        });
    });
</script>







